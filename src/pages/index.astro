---
import Layout from "../layouts/Layout.astro";
import HomeWorkspace from "@/components/HomeWorkspace";
import { and, desc, eq, isNotNull } from "drizzle-orm";
import { tasks } from "../../db/schema";
import { getDb } from "../lib/db";

const db = getDb(Astro.locals);
const publishedTasks = await db
	.select({ taskDate: tasks.taskDate })
	.from(tasks)
	.where(
		and(eq(tasks.type, "article_generation"), isNotNull(tasks.publishedAt)),
	)
	.orderBy(desc(tasks.taskDate));

const publishedDays = Array.from(
	new Set(publishedTasks.map((t) => t.taskDate)),
).sort();
const initialDate = new Date().toISOString().split("T")[0];
---

<Layout
	title="Daily Vocabulary Reader"
	mainClass="p-0 max-w-none overflow-hidden"
>
	<HomeWorkspace
		client:load
		publishedDays={publishedDays}
		initialDate={initialDate}
	/>
</Layout>
